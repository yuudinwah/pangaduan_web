<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengaduan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./../src/js/index.js"></script>
</head>

<body>
    <div class="bg-gray-100">
        <nav id="sidebar"
            class="w-64 md:w-0 fixed transition-all duration-500 ease-in-out h-screen bg-white dark:bg-gray-800 shadow-sm w-0 md:w-64">
            <div class="h-full overflow-y-auto scrollbars">
                <!--logo-->
                <div class="mh-18 text-center py-5">
                    <a href="#" class="relative">
                        <h2 class="text-2xl font-semibold text-gray-200 px-4 max-h-9 overflow-hidden hidden-compact">
                            <img src="./../src/img/logo.svg" alt="Logo" class="inline-block w-7 h-auto mr-2 -mt-1" />
                            <span class="text-gray-700 dark:text-gray-200">Pangadu</span>
                        </h2>
                    </a>
                </div>
                
                <ul id="side-menu" class="w-full float-none flex flex-col font-medium pl-1.5 ">
                    <li class="relative">
                        <a class="block py-2.5 px-6 hover:text-indigo-500 dark:hover:text-gray-300" href="./../dashboard">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                class="inline-block h-4 w-4 mr-2 bi bi-house-door" viewBox="0 0 16 16">
                                <path
                                    d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z">
                                </path>
                            </svg>
                            <span>Dashboards</span>
                        </a>
                    </li>

                    <li>
                        <a
                            class="text-indigo-500 dark:text-gray-300 block py-2.5 px-6 hover:text-indigo-500 dark:hover:text-gray-300 text-indigo-500 dark:text-gray-300">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                class="inline-block h-4 w-4 mr-2 bi bi-calendar4-week" viewBox="0 0 16 16">
                                <path
                                    d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z">
                                </path>
                                <path
                                    d="M11 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-2 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z">
                                </path>
                            </svg>
                            <span>Pengaduan</span>
                        </a>
                    </li>

                    <li class="relative">
                        <a class="block py-2.5 px-6 hover:text-indigo-500 dark:hover:text-gray-300"
                            href="./../manage-account">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                class="inline-block h-4 w-4 mr-2 bi bi-list-nested" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M4.5 11.5A.5.5 0 0 1 5 11h10a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 1 3h10a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5z">
                                </path>
                            </svg>
                            <span>Managemen Akun</span>
                        </a>
                    </li>

                    <li>
                        <a class="block py-2.5 px-6 hover:text-indigo-500 dark:hover:text-gray-300" href="./../log">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                class="inline-block h-4 w-4 mr-2 bi bi-folder" viewBox="0 0 16 16">
                                <path
                                    d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4H2.19zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z">
                                </path>
                            </svg>
                            <span>Log History</span>
                        </a>
                    </li>
                </ul>

                <!-- Banner -->
                <div class="px-4 box-banner">
                    <div class="my-8 p-4 text-center bg-gray-300 dark:bg-gray-700 bg-opacity-50 rounded-lg">
                        <h4 class="font-bold inline-block mb-2">Laporan Pengaduan</h4>
                        <div class="mb-3 text-sm">
                            List laporan bulan ini siap didownload!
                        </div>

                        <div class="grid">
                            <a href="#"
                                class="py-2 px-4 inline-block text-center mb-3 rounded leading-5 text-gray-100 bg-pink-500 border border-pink-500 hover:text-white hover:bg-pink-600 hover:ring-0 hover:border-pink-600 focus:bg-pink-600 focus:border-pink-600 focus:outline-none focus:ring-0"
                                target="_blank">Download</a>
                        </div>
                    </div>
                </div><!-- end banner -->

            </div>
        </nav>
        <div id="body"
            class="ml-64 -mr-64 md:ml-0 md:mr-0 flex flex-col min-h-screen transition-all duration-500 ease-in-out ml-0 mr-0 md:ml-64">
            <!-- Navbar -->
            <nav class="left-64 -right-64 md:left-0 md:right-0 z-50 fixed flex flex-row flex-nowrap items-center justify-between mt-0 py-2 left-0 md:left-64 right-0 px-6 bg-white dark:bg-gray-800 shadow-sm transition-all duration-500 ease-in-out"
                id="navbar">
                <!-- sidenav button-->
                <button onclick="openNav()" type="button"
                    class="inline-flex items-center justify-center text-gray-800 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-200 focus:outline-none focus:ring-0"
                    aria-expanded="false">
                    <span class="sr-only">Mobile menu</span>
                    <svg x-description="Icon open" x-state:on="Menu open" x-state:off="Menu closed"
                        class="hidden h-8 w-8" :class="{ 'block': open, 'hidden': !(open) }"
                        xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                        <path class="hidden md:block" fill-rule="evenodd"
                            d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z">
                        </path>
                        <path class="md:hidden"
                            d="M2 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z">
                        </path>
                    </svg>

                    <svg x-description="Icon closed" x-state:on="Menu open" x-state:off="Menu closed"
                        class="block h-8 w-8" :class="{ 'hidden': open, 'block': !(open) }"
                        xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                        <path class="md:hidden" fill-rule="evenodd"
                            d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z">
                        </path>
                        <path class="hidden md:block"
                            d="M2 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z">
                        </path>
                    </svg>
                    <!-- <i class="text-2xl fas fa-bars"></i> -->
                </button>

                <!-- Search -->
                <form class="hidden sm:inline-block md:hidden lg:inline-block mx-5">
                    <div class="flex flex-wrap items-stretch w-full relative">
                        <input type="text"
                            class="flex-shrink flex-grow max-w-full leading-5 relative text-sm py-2 px-4 rounded-l text-gray-800 bg-gray-100 overflow-x-auto focus:outline-none border border-gray-100 focus:border-gray-200 focus:ring-0 dark:text-gray-400 dark:bg-gray-700 dark:border-gray-700 dark:focus:border-gray-600"
                            placeholder="Searchâ€¦" aria-label="Search">
                        <div class="flex -mr-px">
                            <button
                                class="flex items-center py-2 px-4 -ml-1 rounded-r  leading-5 text-gray-100 bg-indigo-500 border border-indigo-500 hover:text-white hover:bg-indigo-600 hover:ring-0 hover:border-indigo-600 focus:bg-indigo-600 focus:border-indigo-600 focus:outline-none focus:ring-0"
                                type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="w-5 h-5">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                                <!-- <i class="fas fa-search"></i> -->
                            </button>
                        </div>
                    </div>
                </form>

                <!-- menu -->
                <ul class="flex ml-auto mt-2">

                    <!-- profile -->
                    <li class="relative">
                        <a class="px-3 flex text-sm rounded-full focus:outline-none">
                            <div id="navbar-user-name" class="md:block ml-1 self-center"> - </div>
                            <button
                                class="ml-4 flex items-center py-2 px-4 -ml-1 rounded leading-5 text-gray-100 bg-red-500 border border-red-500 hover:text-white hover:bg-red-600 hover:ring-0 hover:border-red-600 focus:bg-red-600 focus:border-red-600 focus:outline-none focus:ring-0"
                                type="button">

                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                    class="inline mr-2 w-4 h-4 bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z">
                                    </path>
                                    <path fill-rule="evenodd"
                                        d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z">
                                    </path>
                                </svg>

                                <!-- <i class="fas fa-search"></i> -->
                            </button>


                        </a>

                    </li>
                </ul>
            </nav>
            <!-- End Navbar -->
            <main class="pt-20 -mt-2">
                <div class="mx-auto p-2">
                    <div class="flex flex-wrap flex-row">
                        <div class="flex-shrink max-w-full px-4 w-full">
                            <p class="text-xl font-bold mt-3 mb-5">Pengaduan</p>
                        </div>
                        <div class="flex-col max-w-full px-4 w-full mb-6">
                            <div class="py-8 px-6 bg-white rounded-lg shadow-lg h-full">
                                <div class="flex flex-wrap flex-row -mx-4">
                                    <div class="flex-shrink max-w-full px-4 w-full">

                                        <div class="w-full pt-4">
                                            <div x-show="tabs === 1">
                                                <p class="my-2 inline-block leading-tight text-center font-semibold py-1 px-3 bg-green-100 text-green-700 dark:bg-opacity-80 rounded-full"
                                                    id="status">Status</p>
                                                <h2 class="text-lg font-semibold mb-2" id="title">Title
                                                </h2>
                                                <p class="mb-4" id="detail">detail.</p>
                                                <h2 class="text-lg font-semibold mb-2">Pengirim</h2>
                                                <ul>
                                                    <li
                                                        class="py-2 border-b dark:border-gray-700 flex items-center justify-between">
                                                        <span class="text-gray-500">Nama:</span> <span id="name"></span>
                                                    </li>
                                                    <li
                                                        class="py-2 border-b dark:border-gray-700 flex items-center justify-between">
                                                        <span class="text-gray-500">Email:</span> <span
                                                            id="email"></span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div id="action" class="my-4 w-full justify-end flex">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="response-form" class="hidden flex-col max-w-full px-4 w-full mb-6">
                            <div class="py-8 px-6 bg-white rounded-lg shadow-lg h-full">
                                <div class="flex flex-wrap flex-row -mx-4">
                                    <div class="flex-shrink max-w-full px-4 w-full">
                                        <h2 class="text-lg mb-2 font-semibold text-gray-800 dark:text-gray-300">Respon
                                            Pengaduan</h2>
                                        <div class="px-6 py-3 p-6 flex-grow ">
                                            <div class="flex-col py-2">
                                                <div class="py-2 text-md justify-start text-left">Laporan</div>
                                                <div class="w-full ">
                                                    <textarea cols="10" id="respond-detail"
                                                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-400 focus:border-blue-400 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-400 dark:focus:border-blue-400"></textarea>
                                                </div>
                                            </div>
                                            <div class="pt-8 flex">
                                                <button type="button" onclick="sendCaseResponse()"
                                                    class="w-full py-2 px-4 mx-1 inline-block text-center rounded leading-5 text-gray-100 bg-indigo-500 border border-indigo-500 hover:text-white hover:bg-indigo-600 hover:ring-0 hover:border-indigo-600 focus:bg-indigo-600 focus:border-indigo-600 focus:outline-none focus:ring-0">
                                                    Kirim
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="response-component" class="hidden flex-col max-w-full px-4 w-full mb-6">
                            <div id="response-data" class="py-8 px-6 bg-white rounded-lg shadow-lg h-full">

                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="bg-white dark:bg-gray-800 p-6 shadow-sm">
                <div class="mx-auto">
                    <div class="flex flex-wrap flex-row -mx-4">
                        <div class="flex-shrink max-w-full px-4 w-full md:w-1/2 text-center md:text-left">
                        </div>
                        <div class="flex-shrink max-w-full px-4 w-full md:w-1/2 text-center md:text-right">
                            <p class="mb-0 mt-3 md:mt-0">
                                <a href="./../" class="hover:text-indigo-500">Pangadu</a> | Ini WM @yuudinwah
                            </p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script>
        window.onload = init()
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        var open = true
        var user = {}
        var caseData = {}

        async function init() {
            var token = checkLogin();
            if (!token) {
                window.location.href = `./../signin`;
            }
            user = await userGet();
            document.getElementById('navbar-user-name').innerHTML = `${user.name}`

            caseData = await caseGet(urlParams.get('id'));
            if (caseData) {
                document.getElementById('title').innerHTML = `${caseData.title}`
                document.getElementById('detail').innerHTML = `${caseData.detail}`
                document.getElementById('status').innerHTML = `${caseData.status}`
                document.getElementById('name').innerHTML = `${caseData.name}`
                document.getElementById('email').innerHTML = `${caseData.email}`
                actionButton()
            } else {
                window.location.href = `./`;
            }

            if (caseData.status === 'Proses')
                document.getElementById('response-form').classList.remove('hidden')


            var caseResponses = await caseResponseFetch(caseData.id);
            var caseResponsesWidget = ``
            for (var index in caseResponses) {
                console.log(caseResponses[index], ',,,,,')
                caseResponsesWidget +=
                    `<div class="py-2 border-b dark:border-gray-700 flex-col items-center justify-between"><div class="text-gray-500">${caseResponses[index].createdAt}</div> <div id>${caseResponses[index].response}</div></div>`
            }
            document.getElementById('response-data').innerHTML = caseResponsesWidget
            if (caseData.status != 'Menunggu')
                document.getElementById('response-component').classList.remove('hidden')
        }

        async function action() {
            var status = ''
            if (caseData.status === 'Menunggu')
                status = 'Proses'
            else if (caseData.status === 'Proses')
                status = 'Selesai'

            var respon = await caseUpdate(caseData.id, { name: caseData.name, email: caseData.email, title: caseData.title, detail: caseData.detail, status: status })
            if (respon) {
                Swal.fire({
                    title: 'Berhasil!',
                    text: 'Pegaduan berhasil diubah',
                    icon: 'success',
                    confirmButtonText: 'Kembali'
                }).then((_) => {
                    if (_.isConfirmed) {
                        location.reload();
                    }
                })
            } else {
                Swal.fire({
                    title: 'Gagal!',
                    text: 'Pegaduan gagal diubah',
                    icon: 'error',
                    confirmButtonText: 'Kembali'
                })
            }
        }

        function actionButton() {
            if (caseData.status === 'Menunggu')
                document.getElementById('action').innerHTML = `<button onclick="action()" type="button" id="button-cart" data-loading-text="Loading..." class="py-2 px-5 inline-block text-center rounded leading-5 text-gray-100 bg-indigo-500 border border-indigo-500 hover:text-white hover:bg-indigo-600 hover:ring-0 hover:border-indigo-600 focus:bg-indigo-600 focus:border-indigo-600 focus:outline-none focus:ring-0">Proses</button>`
            else if (caseData.status === 'Proses')
                document.getElementById('action').innerHTML = `<button onclick="action()" type="button" id="button-cart" data-loading-text="Loading..." class="py-2 px-5 inline-block text-center rounded leading-5 text-gray-100 bg-green-500 border border-green-500 hover:text-white hover:bg-green-600 hover:ring-0 hover:border-green-600 focus:bg-green-600 focus:border-green-600 focus:outline-none focus:ring-0">Selesai</button>`
        }

        async function sendCaseResponse() {
            var respon = await caseResponseAdd({
                userID: user.id,
                caseID: caseData.id,
                caseResponse: document.getElementById("respond-detail").value
            })
            if (respon) {
                Swal.fire({
                    title: 'Berhasil!',
                    text: 'Respon berhasil ditambahkan',
                    icon: 'success',
                    confirmButtonText: 'Kembali'
                }).then((_) => {
                    if (_.isConfirmed) {
                        location.reload();
                    }
                })
            } else {
                Swal.fire({
                    title: 'Gagal!',
                    text: 'Respon gagal ditambahkan',
                    icon: 'error',
                    confirmButtonText: 'Kembali'
                })
            }
        }

        async function falseCase() {
            location.reload();
        }

        async function openNav() {
            open = !open
            if (open) {
                document.getElementById('sidebar').className = 'w-64 fixed transition-all duration-500 ease-in-out h-screen bg-white dark:bg-gray-800 shadow-sm md:w-64'
                document.getElementById('body').className = 'ml-64 md:ml-0 md:mr-0 flex flex-col min-h-screen transition-all duration-500 ease-in-out ml-0 mr-0 md:ml-64'
                document.getElementById('navbar').className = 'left-64 md:left-0 md:right-0 z-50 fixed flex flex-row flex-nowrap items-center justify-between mt-0 py-2 left-0 md:left-64 right-0 px-6 bg-white dark:bg-gray-800 shadow-sm transition-all duration-500 ease-in-out'
            }
            else {
                document.getElementById('sidebar').className = 'w-0 fixed transition-all duration-500 ease-in-out h-screen bg-white dark:bg-gray-800 shadow-sm md:w-0'
                document.getElementById('body').className = 'ml-0 md:ml-0 md:mr-0 flex flex-col min-h-screen transition-all duration-500 ease-in-out ml-0 mr-0 md:ml-0'
                document.getElementById('navbar').className = 'left-0 md:left-0 md:right-0 z-50 fixed flex flex-row flex-nowrap items-center justify-between mt-0 py-2 left-0 md:left-0 right-0 px-6 bg-white dark:bg-gray-800 shadow-sm transition-all duration-500 ease-in-out'
            }
        }
    </script>
</body>

</html>